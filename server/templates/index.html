<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            background-color: white;
        }
        th, td {
            border: 1px solid #aaa;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #eee;
        }
        .expired {
            color: red;
        }
        .active {
            color: green;
        }
    </style>
</head>
<body>

    <div style="margin-bottom: 20px;">
  <a href="/admin" style="margin-right: 10px;">üìã –í—Å–µ</a>
  <a href="/admin?status=active" style="margin-right: 10px;">‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–µ</a>
  <a href="/admin?status=expired">‚ùå –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ</a>
  <a href="/admin/users" style="margin-left: 30px;">üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
  <a href="/admin/machines" style="display: inline-block; margin-bottom: 20px;">üñ•Ô∏è –ú–∞—à–∏–Ω—ã</a>
</div>

    <form method="get" action="/admin/" style="margin-bottom: 20px;">
  <label for="status">–°—Ç–∞—Ç—É—Å:</label>
  <select name="status" id="status">
    <option value="">–í—Å–µ</option>
    <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
    <option value="expired">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ</option>
  </select>

  <label for="sort">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
  <select name="sort" id="sort">
    <option value="valid_until_asc">–ü–æ —Å—Ä–æ–∫—É ‚Üë</option>
    <option value="valid_until_desc">–ü–æ —Å—Ä–æ–∫—É ‚Üì</option>
  </select>

  <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
</form>

<h2>‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ª–∏—Ü–µ–Ω–∑–∏—é</h2>
<form method="post" action="/admin/create" style="margin-bottom: 30px;">
    <label for="telegram_id">Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
    <input type="text" id="telegram_id" name="telegram_id" required>

    <label for="days">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (–≤ –¥–Ω—è—Ö):</label>
    <input type="number" id="days" name="days" value="30" min="1" required>

    <button type="submit">–°–æ–∑–¥–∞—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—é</button>
</form>

<form method="get" action="/admin" style="margin-bottom: 20px;">
    <label for="q">–ü–æ–∏—Å–∫:</label>
    <input type="text" id="q" name="q" value="{{ q or '' }}" placeholder="ID, –∫–ª—é—á, –º–∞—à–∏–Ω–∞">

    <label for="status">–°—Ç–∞—Ç—É—Å:</label>
    <select name="status" id="status">
        <option value="" {% if selected_status == "" %}selected{% endif %}>–í—Å–µ</option>
        <option value="active" {% if selected_status == "active" %}selected{% endif %}>–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
        <option value="expired" {% if selected_status == "expired" %}selected{% endif %}>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ</option>
    </select>

    <label for="sort">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
    <select name="sort" id="sort">
        <option value="valid_until_asc" {% if selected_sort == "valid_until_asc" %}selected{% endif %}>–ü–æ —Å—Ä–æ–∫—É ‚Üë</option>
        <option value="valid_until_desc" {% if selected_sort == "valid_until_desc" %}selected{% endif %}>–ü–æ —Å—Ä–æ–∫—É ‚Üì</option>
    </select>

    <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
</form>

    <h1>üîê –õ–∏—Ü–µ–Ω–∑–∏–∏</h1>
    <table>
        <tr>
            <th>–ö–ª—é—á</th>
            <th>–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ</th>
            <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
            <th>–ú–∞—à–∏–Ω–∞</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        {% for lic in licenses %}
        <tr>
            <td><code>{{ lic.key }}</code></td>
            <td>{{ lic.valid_until }}</td>
            <td>{{ lic.user_id }}</td>
            <td>{{ lic.machine }}</td>
            <td class="{{ 'active' if '–ê–∫—Ç–∏–≤–Ω–∞' in lic.status else 'expired' }}">{{ lic.status }}</td>
            <td>
                <form method="post" action="/admin/delete" style="display:inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –ª–∏—Ü–µ–Ω–∑–∏—é?');">
                    <input type="hidden" name="license_key" value="{{ lic.key }}">
                    <button type="submit">üóë</button>
                </form>
                
                {% if "–ê–∫—Ç–∏–≤–Ω–∞" in lic.status %}
                <form method="post" action="/admin/extend" style="display:inline; margin-left: 5px;">
                    <input type="hidden" name="license_key" value="{{ lic.key }}">
                    <button type="submit">‚ûï 30 –¥–Ω.</button>
                </form>
                {% endif %}
            <td>
        </tr>
        {% endfor %}
    </table>
</body>
</html>
